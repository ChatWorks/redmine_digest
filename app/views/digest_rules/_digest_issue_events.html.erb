<% d_issue.changes_event_types.each do |event_type| %>
  <% last_user_id = nil %>
    <% d_issue.events[event_type].each_with_index do |event, idx| %>
      <tr>
        <% if idx == 0 %>
          <td rowspan="<%= d_issue.events[event_type].length %>" style="width: 10em; text-align: right; border-right: 3px solid #DDDDDD;">
            <%= l(event_type, :scope => 'event_types') %>
          </td>
        <% end %>

        <td style="width: 10em; text-align: center;">
          <% if last_user_id == event.user.id %>
            &nbsp;
          <% else %>
            <%= link_to event.user.name,
                        {
                            :host => Setting.host_name,
                            :protocol => Setting.protocol,
                            :controller => 'users',
                            :action => 'show',
                            :id => event.user.id
                        },
                        :style => 'color: #10152c; text-decoration: none;' %>
          <% end %>
          <% last_user_id = event.user.id %>
        </td>
        <td style="width: 10em;">
          <%= format_time(event.created_on, digest.recurrent != DigestRule::DAILY) %>
        </td>
        <td>
          <% if event_type == DigestEvent::OTHER_ATTR_CHANGED %>
            <%= event.field_label %>:&nbsp;
          <% end %>
          <%= link_to event.formatted_value,
                      {
                          :host => Setting.host_name,
                          :protocol => Setting.protocol,
                          :controller => 'issues',
                          :action => 'show',
                          :id => event.issue_id,
                          :anchor => "note-#{event.indice}"
                      },
                      :title => d_issue.events_summary(event_type),
                      :style => 'color: #10152c; text-decoration: none;' %>
          <% if event.old_value.present? %>
            <span style="color: #9B9B9B; text-decoration: line-through; ">
              <%= event.formatted_old_value %>
            </span>
          <% end %>
        </td>
      </tr>
    <% end %>
<% end %>
